"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[142],{142:(t,e,a)=>{a.r(e),a.d(e,{default:()=>d});var n=a(6486),s=a.n(n),l=a(1304),i=a.n(l),o=a(3764),u=a(6687),r=axios.CancelToken,c=r.source();const m={name:"AdminCmsLayoutCreate",components:{InputGroup:o.Z,SelectGroup:u.Z},layout:"admin-layout",props:{layout:{type:Object,required:!0},templates:{type:Object,required:!0}},data:function(){return{autoUpdateSlug:!1,formData:{},isInitialisedTemplate:!1,isInitialisedContent:!1,isLoadingTemplate:!1,selectedTemplate:null}},computed:{selectedTemplateHasFields:function(){try{return!!this.selectedTemplate&&this.selectedTemplate.template_fields.length}catch(t){return!1}},selectedTemplateId:function(){var t;return null!==(t=this.formData.template_id)&&void 0!==t?t:""}},created:function(){this.formData={content:{},id:this.layout.id,name:this.layout.name,slug:this.layout.slug,template_id:this.layout.template_id},this.selectedTemplate=s().cloneDeep(this.layout.template),this.setInitialContent()},methods:{cancelLoadTemplate:function(){this.isLoadingTemplate&&(c.cancel("Template load cancelled"),c=r.source())},doesObjectHaveKeys:function(t){try{return Object.keys(t).length}catch(t){return!1}},layoutHasContentField:function(t){try{return this.layout.content.hasOwnProperty(t)}catch(t){return!1}},onNameInput:function(){this.autoUpdateSlug&&(this.formData.slug=this.slugify(this.formData.name))},onSelectedTemplateIdChange:s().debounce((function(){var t=this;this.isInitialisedTemplate?(this.selectedTemplate=null,this.cancelLoadTemplate(),this.selectedTemplateId&&(this.isLoadingTemplate=!0,axios.get(this.$route("admin.api.cms.templates.show",this.selectedTemplateId)).then((function(e){t.selectedTemplate=s().cloneDeep(e.data.data),t.setNewTemplateContent()})).catch((function(e){axios.isCancel(e)||(t.$errorToast("Failed to load selected template"),console.log(e))})).finally((function(){t.isLoadingTemplate=!1})))):this.isInitialisedTemplate=!0}),500),onSlugBlur:function(){this.formData.slug=this.slugify(this.formData.slug)},onSlugInput:function(){this.autoUpdateSlug=!1},setInitialContent:function(){var t=this,e={};this.doesObjectHaveKeys(this.layout.content)&&(e=s().cloneDeep(this.layout.content)),s().forEach(this.selectedTemplate.template_fields,(function(a){t.layoutHasContentField(a.id)||(e[a.id]={data:"",template_field_id:a.id})})),this.formData.content=s().cloneDeep(e),this.isInitialisedContent=!0},setNewTemplateContent:function(){this.selectedTemplateHasFields||(this.formData.content={});var t={};s().forEach(this.selectedTemplate.template_fields,(function(e){t[e.id]={data:"",template_field_id:e.id}})),this.$set(this.formData,"content",s().cloneDeep(t))},slugify:function(t){return t&&t.length?i()(t,{lower:!0}):""},submit:function(){this.$inertia.put(this.$route("admin.cms.layouts.update",this.layout.id),this.formData)}},watch:{selectedTemplateId:{handler:"onSelectedTemplateIdChange"}}};const d=(0,a(1900).Z)(m,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{staticClass:"max-w-5xl mx-auto",attrs:{autocomplete:"off"},on:{submit:function(e){return e.preventDefault(),t.submit.apply(null,arguments)}}},[t.userCan("cms_advanced.edit")?a("div",{staticClass:"flex flex-row items-center mb-6"},[a("h1",{staticClass:"font-medium mr-auto text-lg"},[t._v("\n            Edit Layout\n        ")]),t._v(" "),t.userCan("cms_advanced.view")?a("inertia-link",{staticClass:"\n                button button-default-responsive button-primary-subtle\n                flex flex-row items-center mr-2\n            ",attrs:{href:t.$route("admin.cms.layouts.index")}},[a("icon-chevron-left",{staticClass:"w-5 md:mr-2"}),t._v(" "),a("span",{staticClass:"hidden md:inline"},[t._v("\n                Back\n            ")])],1):t._e(),t._v(" "),a("button",{staticClass:"\n                button button-default-responsive button-primary\n                flex flex-row items-center\n            ",attrs:{type:"submit"}},[a("icon-save",{staticClass:"w-5 md:mr-2"}),t._v(" "),a("span",{staticClass:"hidden md:inline"},[t._v("\n                Save Changes\n            ")])],1)],1):t._e(),t._v(" "),a("div",{staticClass:"bg-white py-6 shadow-subtle rounded-lg"},[a("div",{staticClass:"block px-6 w-full"},[a("select-group",{attrs:{"error-message":t.getPageErrorMessage("template_id"),"label-text":"Template","input-any-option-enabled":!0,"input-any-option-label":"Please select a template","input-autofocus":!0,"input-id":"template_id","input-name":"template_id","input-options":t.templates,"input-option-label-key":"name","input-option-value-key":"id","input-required":!0},on:{errorHidden:function(e){return t.clearPageErrorMessage("template_id")}},model:{value:t.formData.template_id,callback:function(e){t.$set(t.formData,"template_id",e)},expression:"formData.template_id"}}),t._v(" "),a("input-group",{staticClass:"mt-4",attrs:{"error-message":t.getPageErrorMessage("name"),"input-autocomplete":"layout_name","input-id":"name","input-name":"name","input-required":!0,"input-type":"text","label-text":"Layout Name"},on:{errorHidden:function(e){return t.clearPageErrorMessage("name")},input:t.onNameInput},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}}),t._v(" "),a("input-group",{staticClass:"mt-4",attrs:{"error-message":t.getPageErrorMessage("slug"),"input-autocomplete":"layout_slug","input-id":"slug","input-name":"slug","input-required":!0,"input-type":"text","label-text":"Layout Slug"},on:{blur:t.onSlugBlur,errorHidden:function(e){return t.clearPageErrorMessage("slug")},input:t.onSlugInput},model:{value:t.formData.slug,callback:function(e){t.$set(t.formData,"slug",e)},expression:"formData.slug"}})],1)]),t._v(" "),!this.isLoadingTemplate&&t.selectedTemplateHasFields&&t.isInitialisedContent?a("div",{staticClass:"bg-white mt-6 px-4 py-6 shadow-subtle rounded-lg"},[a("p",{staticClass:"text-lg"},[t._v("Fields")]),t._v(" "),a("content-editor",{staticClass:"mt-4",attrs:{"template-fields":t.selectedTemplate.template_fields},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1):t._e()])}),[],!1,null,null,null).exports}}]);