import{s as n}from"./vendor.21c2b6f5.js";import{I as i}from"./InputGroup.548575c6.js";import{M as o,U as u}from"./UrlEditor.5b81ba5d.js";import{S as p}from"./app.981887f4.js";import{n as m}from"./LogoLight.eb2f8316.js";import"./DateTimePickerGroup.f713b50e.js";import"./InlineCheckboxGroup.03ba61c7.js";import"./checkbox-form-group.50e62bcf.js";import"./ConfirmationModal.41eb8e05.js";let s=axios.CancelToken,l=s.source();const d={name:"AdminCmsPageCreate",components:{InputGroup:i,MetadataEditor:o,SelectGroup:p,UrlEditor:u},layout:"admin-layout",props:{layouts:{required:!0,type:Object|Array},parentPages:{required:!0,type:Object|Array|null},templates:{required:!0,type:Object|Array}},data(){return{autoUpdateSlug:!0,computedUrl:"",formData:{layout_id:"",metadata:{},name:"",parent_id:"",slug:"",template_id:"",url:{}},isLoadingTemplate:!1,isUrlAvailable:!1,selectedTemplate:null}},computed:{isLayouts(){try{return Object.keys(this.layouts).length}catch{return!1}},isTemplates(){try{return Object.keys(this.templates).length}catch{return!1}},parentPagesUrls(){try{if(!Object.keys(this.parentPages).length)return null;let t={};return _.forEach(this.parentPages,(e,a)=>{t[a]={id:e.id,label:e.name+" => "+e.url.url_full,url_full:e.url.url_full,url_main:e.url.url_main}}),t}catch{return null}},parentPagesMap(){try{if(!Object.keys(this.parentPages).length)return null;let t={};return _.forEach(this.parentPages,(e,a)=>{t[e.id]=a}),t}catch{return null}},selectedParentPage(){try{return this.formData.parent_id?this.parentPages[this.parentPagesMap[this.formData.parent_id]]:null}catch{return null}},selectedParentPageUrl(){try{return this.selectedParentPage.url.url_full}catch{return null}},selectedTemplateHasFields(){try{return this.selectedTemplate?this.selectedTemplate.template_fields.length:!1}catch{return!1}},selectedTemplateId(){var t;return(t=this.formData.template_id)!=null?t:""}},methods:{cancelLoadTemplate(){this.isLoadingTemplate&&(l.cancel("Template load cancelled"),l=s.source())},onNameInput(){!this.autoUpdateSlug||(this.formData.slug=this.slugify(this.formData.name),this.computedUrl=this.formData.slug)},onSelectedTemplateIdChange:_.debounce(function(){this.selectedTemplate=null,this.cancelLoadTemplate(),this.selectedTemplateId&&(this.isLoadingTemplate=!0,axios.get(this.$route("admin.api.cms.templates.show",this.selectedTemplateId)).then(t=>{this.selectedTemplate=_.cloneDeep(t.data.data),this.setNewTemplateContent()}).catch(t=>{axios.isCancel(t)||(this.$errorToast("Failed to load selected template"),console.log(t))}).finally(()=>{this.isLoadingTemplate=!1}))},500),onSlugBlur(){this.formData.slug=this.slugify(this.formData.slug)},onSlugInput(){this.autoUpdateSlug=!1,this.computedUrl=this.formData.slug},onUrlIsAvailableEvent(t){this.isUrlAvailable=t},setNewTemplateContent(){this.selectedTemplateHasFields||(this.formData.content={});let t={};_.forEach(this.selectedTemplate.template_fields,e=>{t[e.id]={data:"",template_field_id:e.id}}),this.$set(this.formData,"content",_.cloneDeep(t))},slugify(t){return!t||!t.length?"":n(t,{lower:!0})},submit(){if(!this.isUrlAvailable){this.$errorToast("Unable to create page. URL is unavailable");return}this.$inertia.post(this.$route("admin.cms.pages.store"),this.formData)}},watch:{selectedTemplateId:{handler:"onSelectedTemplateIdChange"}}};var c=function(){var e=this,a=e._self._c;return a("form",{staticClass:"max-w-5xl mx-auto",attrs:{autocomplete:"off"},on:{submit:function(r){return r.preventDefault(),e.submit.apply(null,arguments)}}},[e.userCan("cms.create")?a("div",{staticClass:"flex flex-row items-center mb-6 sticky-menu"},[a("h1",{staticClass:"font-medium mr-auto text-lg"},[e._v(" Create Page ")]),e.userCan("cms.view")?a("inertia-link",{staticClass:"button button-default-responsive button-primary-subtle flex flex-row items-center mr-2",attrs:{href:e.$route("admin.cms.pages.index")}},[a("icon-chevron-left",{staticClass:"w-5 md:mr-2"}),a("span",{staticClass:"hidden md:inline"},[e._v(" Back ")])],1):e._e(),a("button",{staticClass:"button button-default-responsive button-primary flex flex-row items-center",attrs:{type:"submit"}},[a("icon-save",{staticClass:"w-5 md:mr-2"}),a("span",{staticClass:"hidden md:inline"},[e._v(" Create Page ")])],1)],1):e._e(),a("div",{staticClass:"bg-white py-6 shadow-subtle rounded-lg"},[a("div",{staticClass:"block px-6 w-full"},[a("select-group",{attrs:{"error-message":e.getPageErrorMessage("layout_id"),"label-text":"Layout","input-any-option-enabled":!0,"input-any-option-label":"Please select a Layout","input-autofocus":!0,"input-id":"layout_id","input-name":"layout_id","input-options":e.isLayouts?e.layouts:{},"input-option-label-key":"name","input-option-value-key":"id","input-required":!0},on:{errorHidden:function(r){return e.clearPageErrorMessage("layout_id")}},model:{value:e.formData.layout_id,callback:function(r){e.$set(e.formData,"layout_id",r)},expression:"formData.layout_id"}}),a("select-group",{staticClass:"mt-4",attrs:{"error-message":e.getPageErrorMessage("template_id"),"label-text":"Template","input-any-option-enabled":!0,"input-any-option-label":"Please select a template","input-id":"template_id","input-name":"template_id","input-options":e.isTemplates?e.templates:{},"input-option-label-key":"name","input-option-value-key":"id","input-required":!0},on:{errorHidden:function(r){return e.clearPageErrorMessage("template_id")}},model:{value:e.formData.template_id,callback:function(r){e.$set(e.formData,"template_id",r)},expression:"formData.template_id"}}),e.parentPagesUrls?a("select-group",{staticClass:"mt-4",attrs:{"error-message":e.getPageErrorMessage("parent_id"),"label-text":"Parent Page","input-any-option-enabled":!0,"input-any-option-label":"Please select a parent (optional)","input-id":"parent_id","input-name":"parent_id","input-options":e.parentPagesUrls,"input-option-label-key":"label","input-option-value-key":"id"},on:{errorHidden:function(r){return e.clearPageErrorMessage("parent_id")}},model:{value:e.formData.parent_id,callback:function(r){e.$set(e.formData,"parent_id",r)},expression:"formData.parent_id"}}):e._e(),a("input-group",{staticClass:"mt-4",attrs:{"error-message":e.getPageErrorMessage("name"),"input-autocomplete":"page_name","input-id":"name","input-name":"name","input-required":!0,"input-type":"text","label-text":"Page Name"},on:{errorHidden:function(r){return e.clearPageErrorMessage("name")},input:e.onNameInput},model:{value:e.formData.name,callback:function(r){e.$set(e.formData,"name",r)},expression:"formData.name"}}),a("input-group",{staticClass:"mt-4",attrs:{"error-message":e.getPageErrorMessage("slug"),"input-autocomplete":"page_slug","input-id":"slug","input-name":"slug","input-required":!0,"input-type":"text","label-text":"Page Slug"},on:{blur:e.onSlugBlur,errorHidden:function(r){return e.clearPageErrorMessage("slug")},input:e.onSlugInput},model:{value:e.formData.slug,callback:function(r){e.$set(e.formData,"slug",r)},expression:"formData.slug"}})],1)]),a("div",{staticClass:"bg-white mt-6 overflow-x-hidden px-6 py-6 shadow-subtle rounded-lg"},[a("metadata-editor",{model:{value:e.formData.metadata,callback:function(r){e.$set(e.formData,"metadata",r)},expression:"formData.metadata"}})],1),a("div",{staticClass:"bg-white mt-6 px-6 py-6 shadow-subtle rounded-lg"},[a("url-editor",{attrs:{"computed-url":e.computedUrl,"parent-url":e.selectedParentPageUrl},on:{isAvailable:e.onUrlIsAvailableEvent},model:{value:e.formData.url,callback:function(r){e.$set(e.formData,"url",r)},expression:"formData.url"}})],1),!this.isLoadingTemplate&&e.selectedTemplateHasFields?a("div",{staticClass:"bg-white mt-6 px-6 py-6 shadow-subtle rounded-lg"},[a("p",{staticClass:"text-lg"},[e._v("Fields")]),a("content-editor",{staticClass:"mt-4",attrs:{"template-fields":e.selectedTemplate.template_fields},model:{value:e.formData.content,callback:function(r){e.$set(e.formData,"content",r)},expression:"formData.content"}})],1):e._e()])},f=[],g=m(d,c,f,!1,null,null,null,null);const k=g.exports;export{k as default};
